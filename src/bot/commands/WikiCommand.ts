import { Context } from 'telegraf';
import { CommandHandler } from './base/CommandHandler';

export class WikiCommand extends CommandHandler {
  get command(): string {
    return 'wiki';
  }

  get description(): string {
    return 'Подробная документация по боту';
  }

  async execute(ctx: Context): Promise<void> {
    const wiki = `
📚 **WIKI - Полная документация бота**

═══════════════════════════
👤 **ДЛЯ ВСЕХ ПОЛЬЗОВАТЕЛЕЙ**
═══════════════════════════

**Начало работы:**
\`/start\` - Запустить бота и зарегистрироваться
\`/help\` - Краткая справка по командам
\`/mygroups\` - Список ваших групп с быстрым доступом

**Работа с группами:**
\`/creategroup\` - Создать новую группу (вы станете админом)
\`/register\` - Присоединиться к существующей группе по коду

**Просмотр информации:**
\`/games\` - Показать ближайшие игры (в группе)
\`/locations\` - Список всех локаций группы (в группе)

**Участие в играх:**
• Нажмите "✅ Точно" - точно придёте
• Нажмите "❓ Не точно" - возможно придёте
• Нажмите "👥 Список участников" - кто идёт
• Нажмите "❌ Не пойду" - отказаться от участия

═══════════════════════════
👑 **ДЛЯ АДМИНИСТРАТОРОВ**
═══════════════════════════

**📍 УПРАВЛЕНИЕ ЛОКАЦИЯМИ**

\`/addlocation\` - Добавить новую локацию
├─ Выбираете вид спорта
├─ Выбираете существующую или создаёте новую
└─ Указываете ссылку на карту (опционально)

\`/editlocation\` - Редактировать локацию
├─ **Название** - изменить название
├─ **Карта** - добавить/изменить/удалить ссылку
└─ **Виды спорта** - добавить/убрать виды спорта

\`/locations\` → "⚙️ Управление"
├─ Просмотр всех локаций
├─ Клик на локацию → детали → "✏️ Редактировать"
└─ Удаление через "🗑" (только если нет игр)

**⚽ УПРАВЛЕНИЕ ИГРАМИ**

**Создание игры:**
1. Нажмите "➕ Создать игру" в меню группы
2. Выберите вид спорта (⚽🏀🏐 и т.д.)
3. Укажите дату и время (формат: ДД.ММ ЧЧ:ММ)
   Примеры: \`15.02 18:00\`, \`01.03 20:30\`
4. Выберите локацию или введите свою
5. Укажите макс. участников (число)
6. Укажите мин. участников (число, опционально)
7. Укажите стоимость (число или 0)
8. Добавьте заметки (опционально, "-" для пропуска)
9. Подтвердите создание

**Управление созданной игрой:**
• "🗑 Удалить игру" - отменить игру
• Автоматическая отправка в группу
• Участники видят игру и могут записаться

**👥 УПРАВЛЕНИЕ ГРУППОЙ**

**Меню группы (\`/mygroups\` → выбор):**
├─ Информация о группе
├─ Список участников
├─ Управление участниками (удаление)
└─ Создание игр

**Приглашение участников:**
• Код группы виден в меню группы
• Участники используют \`/register\` и вводят код
• Или добавьте бота в групповой чат

═══════════════════════════
🎯 **ПОЛЕЗНЫЕ СОВЕТЫ**
═══════════════════════════

**Локации:**
• Одна локация может быть для нескольких видов спорта
• Добавляйте ссылку на карту для удобства
• Google Maps: \`https://maps.google.com/?q=40.4093,49.8671\`
• Yandex: \`https://yandex.ru/maps/?ll=49.867,40.409\`

**Игры:**
• Создавайте игры заранее для лучшей явки
• Указывайте мин. участников для автоотмены
• Стоимость 0 = бесплатная игра
• Заметки: дополнительные детали, что взять и т.д.

**Статусы участия:**
• ✅ Точно - подтверждённый участник
• ❓ Не точно - возможный участник (не в счёт)
• Админы видят полный список в "👥 Список"

**Уведомления:**
• Бот отправляет игры в группу автоматически
• Участники получают карточку с кнопками
• Обновления статуса видны всем

═══════════════════════════
⚙️ **ТЕХНИЧЕСКИЕ ДЕТАЛИ**
═══════════════════════════

**Форматы ввода:**
• Дата: ДД.ММ ЧЧ:ММ (15.02 18:00)
• Стоимость: число (100 или 0)
• Участники: число (10, 15, 20)
• URL карты: https://... или http://...

**Ограничения:**
• Название локации: до 255 символов
• Ссылка на карту: до 500 символов
• Заметки к игре: до 1000 символов

**Статусы игр:**
• PLANNED - запланирована
• CANCELLED - отменена
• COMPLETED - завершена

═══════════════════════════
❓ **ЧАСТЫЕ ВОПРОСЫ**
═══════════════════════════

**Q: Как удалить участника из группы?**
A: \`/mygroups\` → группа → "Участники" → 🗑 рядом с именем

**Q: Можно ли изменить игру после создания?**
A: Пока нет, только удалить и создать заново

**Q: Как отменить свою запись на игру?**
A: Нажмите "❌ Не пойду" под карточкой игры

**Q: Можно ли быть в нескольких группах?**
A: Да, без ограничений. \`/mygroups\` покажет все

**Q: Как изменить локацию после создания?**
A: \`/editlocation\` или через \`/locations\` → "⚙️ Управление"

**Q: Как добавить карту к существующей локации?**
A: \`/editlocation\` → выбор локации → "🗺 Ссылку на карту"

═══════════════════════════

💡 Для быстрой справки используйте \`/help\`
🐛 Нашли баг? Сообщите админу группы
`;

    await ctx.reply(wiki, { 
      parse_mode: 'Markdown',
      link_preview_options: { is_disabled: true }
    });
  }
}
