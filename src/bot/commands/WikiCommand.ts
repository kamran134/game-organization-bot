import { Context } from 'telegraf';
import { CommandHandler } from './base/CommandHandler';

export class WikiCommand extends CommandHandler {
  get command(): string {
    return 'wiki';
  }

  get description(): string {
    return 'Подробная документация по боту';
  }

  async execute(ctx: Context): Promise<void> {
    const wiki = `
📚 **WIKI - Полная документация бота**

═══════════════════════════
👤 **ДЛЯ ВСЕХ ПОЛЬЗОВАТЕЛЕЙ**
═══════════════════════════

**Начало работы:**
\`/start\` - Запустить бота и зарегистрироваться
\`/help\` - Краткая справка по командам
\`/mygroups\` - Список ваших групп с быстрым доступом

**Работа с группами:**
\`/creategroup\` - Создать новую группу (вы станете админом)
\`/register\` - Присоединиться к существующей группе по коду

**Просмотр информации:**
\`/games\` - Показать ближайшие игры и тренировки (в группе)
\`/trainings\` - Показать только тренировки (в группе)
\`/locations\` - Список всех локаций группы (в группе)

**Участие в играх и тренировках:**
• Нажмите "✅ Точно" - точно придёте
• Нажмите "❓ Не точно" - возможно придёте
• Нажмите "👥 Список участников" - кто идёт
• Нажмите "❌ Не пойду" - отказаться от участия

═══════════════════════════
👑 **ДЛЯ АДМИНИСТРАТОРОВ**
═══════════════════════════

**📍 УПРАВЛЕНИЕ ЛОКАЦИЯМИ**

\`/addlocation\` - Добавить новую локацию
├─ Выбираете вид спорта
├─ Выбираете существующую или создаёте новую
└─ Указываете ссылку на карту (опционально)

\`/editlocation\` - Редактировать локацию
├─ **Название** - изменить название
├─ **Карта** - добавить/изменить/удалить ссылку
└─ **Виды спорта** - добавить/убрать виды спорта

\`/locations\` → "⚙️ Управление"
├─ Просмотр всех локаций
├─ Клик на локацию → детали → "✏️ Редактировать"
└─ Удаление через "🗑" (только если нет игр)

**⚽ УПРАВЛЕНИЕ ИГРАМИ**

**Создание игры (\`/newgame\`):**
1. Выберите вид спорта (⚽🏀🏐 и т.д.)
2. Укажите дату и время (формат: ДД.ММ ЧЧ:ММ)
   Примеры: \`15.02 18:00\`, \`01.03 20:30\`
3. Выберите локацию или введите свою
4. Укажите мин. участников (число)
5. Укажите макс. участников (число)
6. Укажите стоимость (число или 0)
7. Добавьте заметки (опционально, "-" для пропуска)
8. Подтвердите создание

**🏋️ УПРАВЛЕНИЕ ТРЕНИРОВКАМИ**

**Создание тренировки (\`/newtraining\`):**
1. Выберите вид спорта (⚽🏀🏐 и т.д.)
2. Укажите дату и время (формат: ДД.ММ ЧЧ:ММ)
3. Выберите локацию или введите свою
4. Укажите мин. участников (число)
5. Укажите макс. участников (число или **"-"** для безлимита)
6. Укажите стоимость (число, 0 или **"-"** для бесплатно)
7. Добавьте заметки (опционально, "-" для пропуска)
8. Подтвердите создание

**Отличия тренировок от игр:**
• 🏋️ Свой эмодзи и визуальное оформление
• **Безлимит участников** - введите "-" вместо числа
• **Бесплатно по умолчанию** - "-" или 0 в стоимости
• Отдельная команда \`/trainings\` для просмотра
• В \`/games\` можно фильтровать: "Игры" / "Тренировки" / "Всё"

**Управление играми и тренировками:**
• "🗑 Удалить" - отменить (только для админов)
• Автоматическая отправка в группу
• Участники видят и могут записаться одинаково

**👥 УПРАВЛЕНИЕ ГРУППОЙ**

**Меню группы (\`/mygroups\` → выбор):**
├─ Информация о группе
├─ Список участников
├─ Управление участниками (удаление)
└─ Создание игр и тренировок

**Приглашение участников:**
• Код группы виден в меню группы
• Участники используют \`/register\` и вводят код
• Или добавьте бота в групповой чат

═══════════════════════════
🎯 **ПОЛЕЗНЫЕ СОВЕТЫ**
═══════════════════════════

**Локации:**
• Одна локация может быть для нескольких видов спорта
• Добавляйте ссылку на карту для удобства
• Google Maps: \`https://maps.google.com/?q=40.4093,49.8671\`
• Yandex: \`https://yandex.ru/maps/?ll=49.867,40.409\`

**Игры:**
• Создавайте игры заранее для лучшей явки
• Указывайте мин. участников для автоотмены
• Стоимость 0 = бесплатная игра
• Заметки: дополнительные детали, что взять и т.д.

**Тренировки:**
• Используйте безлимит ("-") для открытых тренировок
• Укажите стоимость 0 или "-" для бесплатных
• Тренировки отображаются с эмодзи 🏋️
• Фильтруйте в \`/games\`: Игры / Тренировки / Всё

**Статусы участия:**
• ✅ Точно - подтверждённый участник
• ❓ Не точно - возможный участник (не в счёт)
• Админы видят полный список в "👥 Список"

**Уведомления:**
• Бот отправляет игры и тренировки в группу автоматически
• Участники получают карточку с кнопками
• Обновления статуса видны всем

═══════════════════════════
⚙️ **ТЕХНИЧЕСКИЕ ДЕТАЛИ**
═══════════════════════════

**Форматы ввода:**
• Дата: ДД.ММ ЧЧ:ММ (15.02 18:00)
• Стоимость: число (100) или 0 или "-"
• Участники: число (10, 15, 20) или "-" (безлимит)
• URL карты: https://... или http://...

**Ограничения:**
• Название локации: до 255 символов
• Ссылка на карту: до 500 символов
• Заметки к игре/тренировке: до 1000 символов

**Статусы игр и тренировок:**
• PLANNED - запланирована
• CANCELLED - отменена
• COMPLETED - завершена

═══════════════════════════
❓ **ЧАСТЫЕ ВОПРОСЫ**
═══════════════════════════

**Q: Как удалить участника из группы?**
A: \`/mygroups\` → группа → "Участники" → 🗑 рядом с именем

**Q: Можно ли изменить игру/тренировку после создания?**
A: Пока нет, только удалить и создать заново

**Q: Как отменить свою запись?**
A: Нажмите "❌ Не пойду" под карточкой

**Q: Можно ли быть в нескольких группах?**
A: Да, без ограничений. \`/mygroups\` покажет все

**Q: Как изменить локацию после создания?**
A: \`/editlocation\` или через \`/locations\` → "⚙️ Управление"

**Q: Как добавить карту к существующей локации?**
A: \`/editlocation\` → выбор локации → "🗺 Ссылку на карту"

**Q: В чём разница между игрой и тренировкой?**
A: Тренировки поддерживают безлимит участников и отображаются отдельно

**Q: Как сделать безлимит участников?**
A: При создании тренировки введите "-" в макс. участниках

**Q: Можно ли показать только тренировки?**
A: Да: \`/trainings\` или в \`/games\` → кнопка "Тренировки"

═══════════════════════════

💡 Для быстрой справки используйте \`/help\`
🐛 Нашли баг? Сообщите админу группы
`;

    await ctx.reply(wiki, { 
      parse_mode: 'Markdown',
      link_preview_options: { is_disabled: true }
    });
  }
}
